<!-- 

To run this demo, you need to replace 'YOUR_API_KEY' with an API key from the ArcGIS Developers dashboard.

Sign up for a free account and get an API key.

https://developers.arcgis.com/documentation/mapping-apis-and-services/get-started/

 -->
<html>

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />
  <title>Directions widget | Sample | ArcGIS API for JavaScript 4.24</title>

  <style>
    html,
    body,
    #viewDiv {
      padding: 0;
      margin: 0;
      height: 100%;
      width: 100%;
    }
  </style>

  <link rel="stylesheet" href="https://js.arcgis.com/4.24/esri/themes/light/main.css" />
  <script src="https://js.arcgis.com/4.24/"></script>

  <script>
    require([
      "esri/WebMap",
      "esri/views/MapView",
      "esri/widgets/Directions",
      "esri/layers/RouteLayer",
      "esri/symbols/CIMSymbol"
    ], function (WebMap, MapView, Directions, RouteLayer, CIMSymbol) {
      const apiKey = "AAPK77b01836d3f5476f8bd938854d43be104Yobwly0j_9TXa7IBCfKLq6F_ItZyJ6s0fzGpIenL_WJlqvG9u7Wzh0BDV8c3EMI";

      const webmap = new WebMap({
        portalItem: {
          id: "57daa2ffe4fc40f6a6b8df596dff3a5a"
        }
      });
      
      const view = new MapView({
        map: webmap,
        container: "viewDiv"
      });

      let originSymbol = {
        type: "cim",
        data: {
          type: "CIMSymbolReference",
          symbol: {
            "type": "CIMPointSymbol",
            "symbolLayers": [{
              "type": "CIMVectorMarker",
              "enable": true,
              "anchorPoint": {
                "x": 0,
                "y": -2
              },
              "anchorPointUnits": "Relative",
              "dominantSizeAxis3D": "Y",
              "size": 10,
              "billboardMode3D": "FaceNearPlane",
              "frame": {
                "xmin": -5,
                "ymin": -5,
                "xmax": 5,
                "ymax": 5
              },
              "markerGraphics": [{
                "type": "CIMMarkerGraphic",
                "geometry": {
                  "rings": [
                    [
                      [
                        0,
                        5
                      ],
                      [
                        0.87,
                        4.92
                      ],
                      [
                        1.71,
                        4.7
                      ],
                      [
                        2.5,
                        4.33
                      ],
                      [
                        3.21,
                        3.83
                      ],
                      [
                        3.83,
                        3.21
                      ],
                      [
                        4.33,
                        2.5
                      ],
                      [
                        4.7,
                        1.71
                      ],
                      [
                        4.92,
                        0.87
                      ],
                      [
                        5,
                        0
                      ],
                      [
                        4.92,
                        -0.87
                      ],
                      [
                        4.7,
                        -1.71
                      ],
                      [
                        4.33,
                        -2.5
                      ],
                      [
                        3.83,
                        -3.21
                      ],
                      [
                        3.21,
                        -3.83
                      ],
                      [
                        2.5,
                        -4.33
                      ],
                      [
                        1.71,
                        -4.7
                      ],
                      [
                        0.87,
                        -4.92
                      ],
                      [
                        0,
                        -5
                      ],
                      [
                        -0.87,
                        -4.92
                      ],
                      [
                        -1.71,
                        -4.7
                      ],
                      [
                        -2.5,
                        -4.33
                      ],
                      [
                        -3.21,
                        -3.83
                      ],
                      [
                        -3.83,
                        -3.21
                      ],
                      [
                        -4.33,
                        -2.5
                      ],
                      [
                        -4.7,
                        -1.71
                      ],
                      [
                        -4.92,
                        -0.87
                      ],
                      [
                        -5,
                        0
                      ],
                      [
                        -4.92,
                        0.87
                      ],
                      [
                        -4.7,
                        1.71
                      ],
                      [
                        -4.33,
                        2.5
                      ],
                      [
                        -3.83,
                        3.21
                      ],
                      [
                        -3.21,
                        3.83
                      ],
                      [
                        -2.5,
                        4.33
                      ],
                      [
                        -1.71,
                        4.7
                      ],
                      [
                        -0.87,
                        4.92
                      ],
                      [
                        0,
                        5
                      ]
                    ]
                  ]
                },
                "symbol": {
                  "type": "CIMPolygonSymbol",
                  "symbolLayers": [{
                    "type": "CIMSolidFill",
                    "enable": true,
                    "color": [
                      255,
                      255,
                      255,
                      255
                    ]
                  }]
                }
              }],
              "scaleSymbolsProportionally": true,
              "respectFrame": true
            },
            {
              "type": "CIMVectorMarker",
              "enable": true,
              "colorLocked": true,
              "anchorPoint": {
                "x": 0,
                "y": -0.5
              },
              "anchorPointUnits": "Relative",
              "dominantSizeAxis3D": "Y",
              "size": 30,
              "billboardMode3D": "FaceNearPlane",
              "frame": {
                "xmin": 0,
                "ymin": 0,
                "xmax": 21,
                "ymax": 21
              },
              "markerGraphics": [{
                "type": "CIMMarkerGraphic",
                "geometry": {
                  "rings": [
                    [
                      [
                        17.17,
                        14.33
                      ],
                      [
                        16.97,
                        12.96
                      ],
                      [
                        16.38,
                        11.37
                      ],
                      [
                        12.16,
                        3.98
                      ],
                      [
                        11.2,
                        1.94
                      ],
                      [
                        10.5,
                        0
                      ],
                      [
                        9.8,
                        1.96
                      ],
                      [
                        8.84,
                        4.02
                      ],
                      [
                        4.61,
                        11.41
                      ],
                      [
                        4.02,
                        12.98
                      ],
                      [
                        3.83,
                        14.33
                      ],
                      [
                        3.96,
                        15.63
                      ],
                      [
                        4.34,
                        16.88
                      ],
                      [
                        4.95,
                        18.03
                      ],
                      [
                        5.78,
                        19.04
                      ],
                      [
                        6.8,
                        19.88
                      ],
                      [
                        7.95,
                        20.49
                      ],
                      [
                        9.2,
                        20.87
                      ],
                      [
                        10.5,
                        21
                      ],
                      [
                        11.8,
                        20.87
                      ],
                      [
                        13.05,
                        20.5
                      ],
                      [
                        14.2,
                        19.88
                      ],
                      [
                        15.22,
                        19.05
                      ],
                      [
                        16.05,
                        18.03
                      ],
                      [
                        16.66,
                        16.88
                      ],
                      [
                        17.04,
                        15.63
                      ],
                      [
                        17.17,
                        14.33
                      ]
                    ]
                  ]
                },
                "symbol": {
                  "type": "CIMPolygonSymbol",
                  "symbolLayers": [{
                    "type": "CIMSolidStroke",
                    "enable": true,
                    "capStyle": "Round",
                    "joinStyle": "Round",
                    "lineStyle3D": "Strip",
                    "miterLimit": 10,
                    "width": 0,
                    "color": [
                      110,
                      110,
                      110,
                      255
                    ]
                  },
                  {
                    "type": "CIMSolidFill",
                    "enable": true,
                    "color": [
                      49,
                      130,
                      189,
                      255
                    ]
                  }
                  ]
                }
              }],
              "scaleSymbolsProportionally": true,
              "respectFrame": true
            }
            ]
          }
        }
      };
      let routeSymbol = {
        type: "cim", // autocasts as CIMSymbol
        data: {
          type: "CIMSymbolReference",
          symbol: {
            type: "CIMLineSymbol",
            symbolLayers: [{
              // arrow symbol
              type: "CIMVectorMarker",
              enable: true,
              size: 6,
              markerPlacement: {
                type: "CIMMarkerPlacementAlongLineSameSize", // places same size markers along the line
                endings: "WithHalfGap",
                placementTemplate: [19.5] // determines space between each arrow
              },
              frame: {
                xmin: -5,
                ymin: -5,
                xmax: 5,
                ymax: 5
              },
              markerGraphics: [{
                type: "CIMMarkerGraphic",
                geometry: {
                  rings: [
                    [
                      [-8, -5.47],
                      [-8, 5.6],
                      [1.96, -0.03],
                      [-8, -5.47]
                    ]
                  ]
                },
                symbol: {
                  // white fill for the arrow symbol
                  type: "CIMPolygonSymbol",
                  symbolLayers: [{
                    type: "CIMSolidFill",
                    enable: true,
                    color: [255, 255, 255, 255]
                  }]
                }
              }]
            },
            {
              // black 1px line symbol
              type: "CIMSolidStroke",
              enable: true,
              width: 5,
              color: [88, 101, 107, 200]
            },
            ]
          }
        }
      };
      const middleSymbol = new CIMSymbol({
        data: {
          type: "CIMSymbolReference",
          symbol:
          {
            "type": "CIMPointSymbol",
            "symbolLayers": [
              {
                "type": "CIMVectorMarker",
                "enable": true,
                "anchorPointUnits": "Relative",
                "dominantSizeAxis3D": "Y",
                "size": 15,
                "billboardMode3D": "FaceNearPlane",
                "frame": {
                  "xmin": 0,
                  "ymin": 0,
                  "xmax": 17,
                  "ymax": 17
                },
                "markerGraphics": [
                  {
                    "type": "CIMMarkerGraphic",
                    "geometry": {
                      "rings": [
                        [
                          [
                            8.5,
                            16.58
                          ],
                          [
                            10.51,
                            10.41
                          ],
                          [
                            17,
                            10.41
                          ],
                          [
                            11.75,
                            6.59
                          ],
                          [
                            13.75,
                            0.42
                          ],
                          [
                            8.5,
                            4.23
                          ],
                          [
                            3.25,
                            0.42
                          ],
                          [
                            5.25,
                            6.59
                          ],
                          [
                            0,
                            10.41
                          ],
                          [
                            6.49,
                            10.41
                          ],
                          [
                            8.5,
                            16.58
                          ]
                        ]
                      ]
                    },
                    "symbol": {
                      "type": "CIMPolygonSymbol",
                      "symbolLayers": [
                        {
                          "type": "CIMSolidStroke",
                          "enable": true,
                          "capStyle": "Round",
                          "joinStyle": "Round",
                          "lineStyle3D": "Strip",
                          "miterLimit": 10,
                          "width": 1,
                          "color": [
                            49,
                            130,
                            189,
                            255
                          ]
                        },
                        {
                          "type": "CIMSolidFill",
                          "enable": true,
                          "color": [
                            255,
                            255,
                            255,
                            255
                          ]
                        }
                      ]
                    }
                  }
                ],
                "scaleSymbolsProportionally": true,
                "respectFrame": true
              }
            ]
          }
        }
      });

      // create a new RouteLayer, required for Directions widget
      const routeLayer = new RouteLayer({
        defaultSymbols: {
          directionLines: routeSymbol,
          stops: {
            first: originSymbol,
            middle: middleSymbol,/*{
              type: "simple-marker",
              size: 12,
              color: "white",
              outline: {
                color: [
                  49,
                  130,
                  189,
                  255
                ],
                size: 3
              }
            },*/
            last: originSymbol
          },
          routeInfo: {
            type: "simple-line",
            width: 0
          }
        }
      });

      webmap.layers.add(routeLayer);

      // Defines an action to zoom out from the selected feature
      let routeAction = {
        // This text is displayed as a tooltip
        title: "Add stop",
        // The ID by which to reference the action in the event handler
        id: "add-stop",
        // Sets the icon font used to style the action button
        className: "esri-icon-map-pin"
      };
      // Adds the custom action to the popup.
      view.popup.actions.push(routeAction);

      // The function to execute when the zoom-out action is clicked
      function addStop(location, title) {
        const newStop = { locationType: "stop",  geometry: { x:location.x, y:location.y }, name: title };
        routeLayer.stops.add(newStop);
        directionsWidget.getDirections();
      }

      // This event fires for each click on any action
      view.popup.on("trigger-action", function (event) {
        // If the zoom-out action is clicked, fire the zoomOut() function
        if (event.action.id === "add-stop") {
          addStop(view.popup.location, view.popup.title);
        }
      });

      // new RouteLayer must be added to Directions widget
      let directionsWidget = new Directions({
        layer: routeLayer,
        apiKey,
        view
      });

      // Add the Directions widget to the top right corner of the view
      view.ui.add(directionsWidget, {
        position: "top-right"
      });
    });
  </script>
</head>

<body>
  <div id="viewDiv"></div>
</body>

</html>